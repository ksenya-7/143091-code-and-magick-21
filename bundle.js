(()=>{"use strict";(()=>{const e=(e,t)=>Math.floor(e+Math.random()*(t+1-e));window.util={isEscape:e=>"Escape"===e.key,isEnter:e=>"Enter"===e.key,getRandom:e,getRandomFrom:t=>t[e(0,t.length-1)]}})(),(()=>{const e="hanging",t=100,n="hsl(0, 0%, 30%)",o="hsl(0, 0%, 100%)",r="hsl(0, 0%, 0%)",s="Ура вы победили!",l="Список результатов:",d=(e,t,n,o)=>{e.fillStyle=o,e.fillRect(t,n,420,270)},i=e=>{let t=e[0];for(let n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return t},a=e=>(420-40*e.length-50*(e.length-1))/2,c=(e,n,o,r,s,l)=>{e.fillStyle=(e=>"Вы"===e?"hsl(0, 100%, 50%)":"hsl(240, "+window.util.getRandom(0,100)+"%, 50%)")(n),e.fillRect(t+a(o)+90*l,240,40,-150*r/i(s))},u=(n,o,s,l,d,c)=>{n.fillStyle=r,n.textBaseline=e,n.fillText(o,t+a(s)+90*c,250),n.fillText(Math.round(l),t+a(s)+90*c,150-150*l/i(d)+70)};window.renderStatistics=(i,a,m)=>{(e=>{d(e,110,20,n),d(e,t,10,o)})(i),(t=>{t.fillStyle=r,t.font="16px PT Mono",t.textBaseline=e,t.fillText(s,120,30),t.fillText(l,120,50)})(i),((e,t,n)=>{for(let o=0;o<t.length;o++)u(e,t[o],t,n[o],n,o),c(e,t[o],t,n[o],n,o)})(i,a,m)}})(),window.debounce=e=>{let t=null;return(...n)=>{t&&window.clearTimeout(t),t=window.setTimeout((()=>{e(...n)}),500)}},(()=>{const e="https://21.javascript.pages.academy/code-and-magick/data",t="https://21.javascript.pages.academy/code-and-magick";window.backend={load:(t,n)=>{const o=new XMLHttpRequest;o.responseType="json",o.addEventListener("load",(()=>{let e;switch(o.status){case 200:t(o.response);break;case 400:e="Неверный запрос";break;case 401:e="Пользователь не авторизован";break;case 404:e="Ничего не найдено";break;default:e="Cтатус ответа: : "+o.status+" "+o.statusText}e&&n(e)})),o.addEventListener("error",(()=>{n("Произошла ошибка соединения")})),o.addEventListener("timeout",(()=>{n("Запрос не успел выполниться за "+o.timeout+" мс")})),o.timeout=1e4,o.open("GET",e),o.send()},save:(e,n)=>{const o=new XMLHttpRequest;o.responseType="json",o.addEventListener("load",(()=>{n(o.response)})),o.open("POST",t),o.send(e)}}})(),(()=>{const e=document.querySelector(".setup-similar-list"),t=document.querySelector("#similar-wizard-template").content.querySelector(".setup-similar-item"),n=e=>{const n=t.cloneNode(!0);return n.querySelector(".setup-similar-label").textContent=e.name,n.querySelector(".wizard-coat").style.fill=e.colorCoat,n.querySelector(".wizard-eyes").style.fill=e.colorEyes,n};window.renderWizards=t=>{const o=document.createDocumentFragment(),r=t.length<4?t.length:4;e.innerHTML="";for(let e=0;e<r;e++)o.append(n(t[e]));e.append(o),document.querySelector(".setup-similar").classList.remove("hidden")}})(),(()=>{const e=["rgb(101, 137, 164)","rgb(241, 43, 107)","rgb(146, 100, 161)","rgb(56, 159, 117)","rgb(215, 210, 55)","rgb(0, 0, 0)"],t=["black","red","blue","yellow","green"],n=["#ee4830","#30a8ee","#5ce6c0","#e848d5","#e6e848"],o=document.querySelector(".setup"),r=document.querySelector(".setup-open"),s=o.querySelector(".setup-close"),l=o.querySelector(".setup-user-name"),d=o.querySelector(".setup-wizard"),i=d.querySelector(".wizard-coat"),a=o.querySelector('[name="coat-color"]'),c=d.querySelector(".wizard-eyes"),u=o.querySelector('[name="eyes-color"]'),m=o.querySelector(".setup-fireball-wrap"),y=m.querySelector(".setup-fireball"),p=m.querySelector("input");let w="rgb(101, 137, 164)",v="black",E=[];const f=e=>{let t=0;return e.colorCoat===w&&(t+=2),e.colorEyes===v&&(t+=1),t},g=()=>{window.renderWizards(E.sort(((e,t)=>((e,t)=>{let n=f(t)-f(e);return 0===n&&(n=((e,t)=>e>t?1:e<t?-1:0)(e.name,t.name)),n})(e,t))))};let L={onEyesChange:window.debounce((e=>{v=e,g()})),onCoatChange:window.debounce((e=>{w=e,g()}))};const h=e=>{window.util.isEscape(e)&&e.target!==l&&(e.preventDefault(),o.classList.add("hidden"))},S=e=>{window.util.isEnter(e)&&e.target===l&&(e.preventDefault(),o.classList.add("hidden"))},k=()=>{o.style.top="80px",o.style.left="50%",o.classList.remove("hidden"),document.addEventListener("keydown",h),document.addEventListener("keydown",S)},b=()=>{o.classList.add("hidden"),document.removeEventListener("keydown",h),document.removeEventListener("keydown",S)};r.addEventListener("click",k),r.addEventListener("keydown",(e=>{window.util.isEnter(e)&&k()})),s.addEventListener("click",b),s.addEventListener("keydown",(e=>{window.util.isEnter(e)&&b()}));const q=(e,t,n)=>{t.value=window.util.getRandomFrom(n),e.style.backgroundColor=t.value},x=(e,t,n,o)=>{t.value=window.util.getRandomFrom(n),e.style.fill=t.value,o(t.value)};i.addEventListener("click",(()=>x(i,a,e,L.onCoatChange))),i.addEventListener("keydown",(t=>!!window.util.isEnter(t)&&x(i,a,e,L.onCoatChange))),c.addEventListener("click",(()=>x(c,u,t,L.onEyesChange))),c.addEventListener("keydown",(e=>!!window.util.isEnter(e)&&x(c,u,t,L.onEyesChange))),m.addEventListener("click",(()=>q(y,p,n))),m.addEventListener("keydown",(e=>!!window.util.isEnter(e)&&q(y,p,n))),window.backend.load((e=>{E=e,g()}),(e=>{let t=document.createElement("div");t.style="z-index: 100; margin: 0 auto; text-align: center;",t.style.position="absolute",t.style.top="25px",t.style.left=0,t.style.right=0,t.style.fontSize="27px",t.style.color="red",t.textContent=e,document.body.insertAdjacentElement("afterbegin",t)})),o.classList.remove("hidden")})(),(()=>{const e=document.querySelector(".upload");e.addEventListener("mousedown",(t=>{t.preventDefault();const n=document.querySelector(".setup");let o={x:t.clientX,y:t.clientY},r=!1;const s=e=>{e.preventDefault(),r=!0;const t=o.x-e.clientX,s=o.y-e.clientY;o={x:e.clientX,y:e.clientY},n.style.top=n.offsetTop-s+"px",n.style.left=n.offsetLeft-t+"px"},l=t=>{if(t.preventDefault(),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",l),r){const t=n=>{n.preventDefault(),e.removeEventListener("click",t)};e.addEventListener("click",t)}};document.addEventListener("mousemove",s),document.addEventListener("mouseup",l)}))})(),(()=>{const e=["gif","jpg","jpeg","png"],t=document.querySelector(".upload input[type=file]"),n=document.querySelector(".setup-user-pic"),o=document.querySelector(".setup-open-icon");t.addEventListener("change",(function(){const r=t.files[0],s=r.name.toLowerCase();if(e.some((e=>s.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{n.src=e.result,o.src=e.result})),e.readAsDataURL(r)}}))})(),(()=>{const e=document.querySelector(".setup-wizard-form");e.addEventListener("submit",(t=>{window.backend.save(new FormData(e),(()=>{document.querySelector(".setup").classList.add("hidden")})),t.preventDefault()}))})()})();